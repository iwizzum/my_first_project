@model ASP.NET_MVC研修.Models.FindModel
@using ASP.NET_MVC研修.Models

<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="~/Content/bootstrap.css" rel="stylesheet">
    <title>ユーザー検索画面</title>
    <script src="~/Scripts/jquery-1.10.2.min.js" type="text/javascript"></script>
    <style type ="text/css">
        body {
            background-color:gray;
            margin:0;
        }
        .tit
        {
        	margin:0 auto;
        	margin-bottom:10px;
            text-align:left;
            background-color:#3399cc;
            color:white;
            height:50px
        }
        .HR {
            padding-left:5px;
            padding-right:5px;
        }
        form 
        {
            display:inline;
            margin-bottom:10px;
        }
        .row
        {
        	margin-bottom:15px;
        }
        .container
        {	
            min-width :800px;
	        width:800px;
	        margin:0 auto;
	        margin-bottom:10px;
            padding-left:20px;
            padding-right:20px;
            background-color:white;
        }
        .form-control
        {
        	border-color:#3399cc;
	        border-radius:7px;
	        height:30px;
        }
        .TEXTBOX {
            width:60%;
            height:30px;
            border-radius:7px;
            border-color:#3399cc;
            margin-bottom:5px;
        }
        table {
            border-collapse:collapse;
            margin-bottom:30px;
        }
        td {
            border:solid 1px;
            border-color:#3399cc;
            padding:0.5em;
        }
        #txt性別
        {
            border-color:#3399cc;
        }
        .OPBIG {
            border-color:#3399cc;
            width:80px;
            border-radius:5px;
            margin-right:20px;
            scrollbar-arrow-color:#0d1f52;
            scrollbar-face-color:#3399cc;
        }
        .OPSML {
            border-color:#3399cc;
            border-radius:5px;
            width:50px;
            margin-right:20px;
        }
        select
        {
        	border-color:#3399cc;
	        border-radius:7px;
	        width:70px
        }
        .TEXTAREA	
        {	
	        height:70px;
        }
        #btn隠し {
            background-color:gray;
            color:white;
        }
        #btn検索 {
            margin-right:300px;
        }
        #btnメール送信 {
            margin-right:10px;
        }
        #btn申請確認 {
            margin-right:10px;
        }
        .BUTTON	
        {	
            background-color:#3399cc;
            border-radius: 10px;
            color:white;
	        width:15%;
	        border-color:#3399cc;
            margin-right:10px;
            margin-bottom:20px;
        }
    </style>
</head>

<header>
    <h1 class = "tit">ユーザー検索</h1>
</header>
<body>
    <div class="container">
    <h2>検索条件</h2>
    
    <hr />
    <form method="post" action="Search" id="Form1">
        <div class ="row">
            <div class ="col-md-4" >ユーザーID</div>
            <div class="col-md-8">
                <input type ="text" name="ユーザーID" id ="txtユーザーID" class="form-control TEXTBOX" />
            </div>
        </div>
        
        <div class ="row">
            <div class ="col-md-4">メールアドレス</div>
            <div class="col-md-8">
                <input type ="text" name="メール"id ="メール" class="form-control" />
            </div>
        </div>
        
        <div class ="row">
            <div class ="col-md-4">ニックネーム</div>
            <div class="col-md-8">
                <input type ="text" name="ニックネーム"id ="txtニックネーム" class="form-control TEXTBOX" />
            </div>
        </div>
        <div class ="row">
            <div class ="col-md-4">氏名</div>
            <div class="col-md-8">
                <input type ="text" name="氏名" id ="txt氏名" class="form-control TEXTBOX" />
            </div>
        </div>
        <div class="row">
            <div class ="col-md-4">性別</div>
            <div class=" col-md-8">
                   <input type="checkbox" name="性別" id="txt性別男" /> 男
                   <input type="checkbox" name="性別" id="txt性別女" /> 女
            </div>
        </div>
        <div class="row">
            <div class ="col-md-4">生年月日</div>
            <div class="col-md-8">
              <select class="OPBIG" name="生年" id="txt生年">
                @{
                    //年のコンボボックスに(1918～2017)の値を出力
                    int year = 2017;
                    for (int i = 0; i < 100; i++,year-- )
                    {
                    <option value="@(year)">@year</option>
                    }   
                 }
              </select>
              <select class="OPSML" name="生月" id="txt生月">
                  @{
                    //月のコンボボックスに(1-12)の値を追加
                    for(int ii=1;ii<13;ii++){
                   
                      if(ii < 10){
                           <option value="0@(ii)">@(ii)</option>
                       }
                      else if(ii >=10){
                          <option value="@(ii)">@(ii)</option>
                      }
                    }
                    }
              </select>
              <select class="OPSML" name="生日" id="txt生日">
                  @{
                    //日のコンボボックスに(1-31)の値を追加
                    for(int iii=1;iii<=31;iii++){
                    
                      if (iii < 10)
                        {
                           <option value="0@(iii.ToString())">@(iii)</option>
                        }
                      else if(iii >=10){
                          <option value="@(iii)">@(iii)</option>
                      }
                    }
                    }
                   
              </select>
                <input type="hidden" name="生年月日" id="txt生年月日" />
             </div>
        </div>
        <div class ="row">
            <div class ="col-md-4">年齢</div>
            <div class="col-md-2">
                <input type ="text" name="年齢" id ="txt年齢" class="form-control TEXTBOX" />
            </div>
        </div>
        <div class ="row">
            <div class ="col-md-4">電話番号</div>
            <div class="col-md-6">
                <input type ="text" name="電話番号" id ="txt電話番号" class="form-control TEXTBOX" />
            </div>
        </div>
        <div class ="row">
            <div class ="col-md-4">郵便番号</div>
            <div class="col-md-4">
                <input type ="text" name="郵便番号" id ="txt郵便番号" class="form-control TEXTBOX" />
            </div>
        </div>
        <div class ="row">
            <div class ="col-md-4">住所</div>
            <div class="col-md-8">
                <input type ="text" name="住所" id ="txt住所" class="form-control TEXTBOX" />
            </div>
        </div>
        <div class="row">
            <div class ="col-md-4">入社日</div>
            <div class="col-md-8">
               <select class="OPBIG" name="入社年" id="txt入社年">
                @{  
                    //年のコンボボックスに(1918～2017)の値を追加
                    int year2 = 2017;
                    for (int i = 0; i < 100; i++, year2--)
                    {
                    <option value="@(year2)">@(year2)</option>
                    }   
                 }
               </select>
             <select class="OPSML" name="入社月" id="txt入社月">
                 @{ 
                     //月のコンボボックスに(1-12)の値を追加
                     for (int ii = 1; ii <= 12; ii++)
                     {
                       
                       if(ii < 10){
                           <option value="0@(ii.ToString())">@(ii)</option>
                       }
                       else if(ii >=10){
                          <option value="@(ii)">@(ii)</option>
                      }
                     }
                    
                 }
             </select>
            <select class="OPSML" name="入社日" id="txt入社日">
                @{  
                    //日のコンボボックスに(1-31)の値を追加
                    for (int iii = 1; iii <= 31; iii++)
                    {
                      
                        if (iii < 10)
                        {
                           <option value="0@(iii.ToString())">@(iii)</option>
                        }
                        else if(iii >=10){
                             <option value="@(iii)">@(iii)</option>
                        }
                    }
                    
                 }
            </select>
               <input type="hidden" name="入社年月日" id="txt入社年月日" />
             </div>
        </div>
        <div class ="row">
            <div class ="col-md-4">所属</div>
            <div class="col-md-2">
                <select name="入社日" id="所属">
                <option value=""></option>
                </select>
            </div>
        </div>
       <div class ="row">
            <div class ="col-md-4">役職</div>
            <div class="col-md-8">
                <input type ="text" name="役職" id ="txt役職" class="form-control TEXTBOX" />
            </div>
        </div>
       <div class ="row">
            <div class ="col-md-4">趣味</div>
            <div class="col-md-8">
                <input type ="text" name="趣味" id ="txt趣味" class="form-control TEXTBOX" />
            </div>
        </div>
       <div class ="row">
            <div class ="col-md-4">特技</div>
            <div class="col-md-8">
                <input type ="text" name="特技" id ="txt特技" class="form-control TEXTBOX" />
            </div>
        </div>
       <div class ="row">
            <div class ="col-md-4">座右銘</div>
            <div class="col-md-8">
                <textarea name="座右銘" id ="txt座右銘" class="form-control TEXTAREA" ></textarea>
            </div>
       </div>
       <input type="button" class="BUTTON" name="検索" id="btn検索" value="検索">
       </form>
           <input type="button" class="BUTTON" name="メール送信" id="btnメール送信" value="メール送信">
           <input type="button" class="BUTTON" name="申請確認" id="btn申請確認" value="申請確認">
           <input type="button" id="btn隠し" value="△"/> 
       <div id="container">
           @Html.Partial("~/Views/FindUser/_FindResult.cshtml",Model)
       </div>    
    </div>
</body>
      <!-- 
                    ページロード時
             すべてのテキストボックスの値を「""」にする
             性別ラジオボタンが選択されないようにする    
           　コンボボックスの値を「""」にする
             
      -->

        <!-- 
    検索ボタンクリック時
    生年コンボボックス、生月コンボボックス、生日コンボボックスの値を連結したものを生年月日テキストボックスの値とする
    入社年コンボボックス、入社月コンボボックス、入社日コンボボックスの値を連結したものを入社年月日テキストボックスの値とする
    性別1ラジオボタンが選択されていた場合そのvalueを性別テキストボックスの値に設定する。
    性別2ラジオボタンが選択されていた場合そのvalueを性別テキストボックスの値に設定する。
    画面で入力した値をサーバーに送信する
    サーバー側でクライアントから送ったデータに該当するデータを「ユーザーマスター」と「プロファイル情報」から取得
    検索結果を検索結果変数に保存する。
    -->

   <!-- 「△」ボタンをクリック時

    ボタンの文字列が「△」の場合
    検索条件を隠す。
    ボタンの文字列を「▽」に変更する。

    ボタンの文字列が「▽」の場合
    検索条件を表示する
    ボタンの文字列を「△」に変更する。
    -->


<script type="text/ecmascript">

    $(document).ready(function () {

        $(".TEXTBOX").val("");

        $(".OPBIG").val("");
        $(".OPSML").val("");
        
    });

    $("#btn検索").click(function () {
    
        var biryear = $("#txt生年").val();
        var birmonth = $("#txt生月").val();
        var birday = $("#txt生日").val();

        if (biryear == null | 0) {
            biryear = "____";
        }
        if (birmonth == null | 0) {
            birmonth = "__"
        }
        if (birday == null | 0) {
            birday = "__"
        }
        $("#txt生年月日").val(biryear + birmonth + birday);

        var hiryear = $("#txt入社年").val();
        var hirmonth = $("#txt入社月").val();
        var hirday = $("#txt入社日").val();

        if (hiryear == null | 0) {
            hiryear = "____";
        }
        if (hirmonth == null | 0) {
            hirmonth = "__"
        }
        if (hirday == null | 0) {
            hirday = "__"
        }

        $("#txt入社年月日").val(hiryear + hirmonth + hirday);

        $("#txt性別").val($("input[name='radio1']:checked").val());

        if ($("input[name='radio1']:checked").val() == undefined) {
            $("#txt性別").val(0);
        }

        $.ajax({
            url: "/FindUser/Search",
            type: "post",
            data: $("#Form1").serialize(),

            //contentType: 'application/json',	
            success: function (data) {
                $("#container").html(data);
            },
            error: function () {
                alert("システムエラーが発生しました");
            }
        });


    });
        $(document).on('change', "[id='txt表示件数']", function () {
            if ($('txt総件数').text() == "0") {
                return;
            }
            $.ajax({
                url: "/FindUser/GetPage",
                type: "post",
                data: JSON.stringify({ rowCount: $("#txt表示件数").val(), pageNum: 1 }),
                contentType: 'application/json',
                success:function(data){
                    $("#container").html(data);
                },
                error: function(){
                    alert("システムエラーが発生しました");
                }
            });
        });


    $(document).on('change', "[id='txt現ページ']", function () {
        if ($('#txt総件数').text() == "0") {
            return;
        }
        $.ajax({
            url: "/FindUser/GetPage",
            type: "post",
            data: JSON.stringify({ rowCount: $("#txt表示件数").val(), pageNum: $('#txt現ページ').val() }),
            contentType: 'application/json',
            success: function (data) {
                $("#container").html(data);
            },
            error: function () {
                alert("システムエラーが発生しました");
            }
        });
    });

    $(document).on('click', "[id='btn前ページ']", function () {
        event.preventDefault();
        var selecting = $('#txt現ページ').val();

        if (selecting == 1) {
            return;
        }

        $('#txt現ページ').val(Number(selecting) - 1);
        $('#btn次ページ').attr("src", "/Images/right_triangle.png");


        $.ajax({
            url: "/FindUser/GetPage",
            type: "post",
            data: JSON.stringify({ rowCount: $("#txt表示件数").val(), pageNum: (Number(selecting) - 1) }),
            contentType: 'application/json',
            success: function (data) {
                $("#container").html(data);
            },
            error: function () {
                alert("システムエラーが発生しました");
            }
        });
    });

    $(document).on('click', "[id='btn次ページ']", function () {
        event.preventDefault();
        var selecting = $('#txt現ページ').val();
        var maxvalue = $('#txt現ページ option:last-child').val();

        if (selecting == maxvalue) {
            return;
        }

        $('#txt現ページ').val(Number(selecting) + 1);
        $('#btn前ページ').attr("src", "/Images/left_triangle.png");


        $.ajax({
            url: "/FindUser/GetPage",
            type: "post",
            data: JSON.stringify({ rowCount: $("#txt表示件数").val(), pageNum: (Number(selecting) + 1) }),
            contentType: 'application/json',
            success: function (data) {
                $("#container").html(data);
            },
            error: function () {
                alert("システムエラーが発生しました");
            }
        });
    });

    function sort(obj) {
        if ($('#txt総件数').text() == "0") {
            return;
        }

        var span = $(obj).find("span");
        var order = span.text().trim();
        var colName = $(obj).text().replace("▲", "").replace("▼", "").trim();



        //タイトルからソート順のマークを削除する			
        $("#検索結果一覧").find("tr:nth-child(1) td").each(function () {

            $(this).find("span").text("");

            if (order == "" || order == "▼") {
                order = "▲";
            }
            else {
                order = "▼";
            }

            $('#btn前ページ').attr("src", "/Images/left_triangle_disable.png");
            $('#txt現ページ').val(1);
            $('#btn次ページ').attr("src", "/Images/right_triangle.png");


            $.ajax({
                url: "/FindUser/Sort",
                type: "post",
                data: JSON.stringify({ colName: colName, sortOrder: order }),
                contentType: 'application/json',
                success: function (data) {
                    $("#container").html(data);
                },
                error: function () {
                    alert("システムエラーが発生しました");
                }
            });
        });

    }

    $('#btnメール送信').click(function (event) {
        event.preventDefault();

        var mails = "";
        //選択されたチェックボックスを探してメール送信画面へ遷移
        $("#検索結果一覧 td:nth-child(1)").find('input[type="checkbox"]').each(function () {
            if ($(this).prop('checked')) {
                if (mails == "") {
                    mails = $(this).val();
                }
                else {
                    mails = mails + ";" + $(this).val();
                }
            }
        });

        OpenSendMail(mails);

    });

    function OpenSendMail(mails) {

        var w_size = 200;
        var h_size = 200;
        var l_position = Number((window.screen.width - w_size) / 2);
        var t_position = Number((window.screen.height - h_size) / 2);

        _window = window.open("", "メール送信", "menubar=yes,location=no,toolbar=no,directories=no,status=no,scrollbars=no,titlebar=no,resizable=no,minwidth=" + w_size + ", height=" + h_size + ",width=" + w_size + ", height=" + h_size + ", left=" + l_position + ", top=" + t_position);
        _window.location.href = "/FindUser/SendMail?mails=" + mails;
        _window.focus();
        return false;
    }



    var i = 0;
    $("#btn隠し").click(function () {

        $(".row").toggle();

        if (i % 2 == 0) {
            $("#btn隠し").val("▽");
            i = i + 1;
        }
        else if (i % 2 == 1) {
            $("#btn隠し").val("△");
            i = i + 1;
        }
    });

</script>
</html>
